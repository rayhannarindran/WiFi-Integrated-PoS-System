{"level":"error","message":"Error inserting token: sanitizedRecord is not defined","service":"db-service","stack":"ReferenceError: sanitizedRecord is not defined\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:14:36\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async insertTokenRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:12:7)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:214:13)"}
{"code":11000,"errorResponse":{"code":11000,"errmsg":"E11000 duplicate key error collection: pos_dummy.tokens index: token_1 dup key: { token: \"exampleToken\" }","index":0,"keyPattern":{"token":1},"keyValue":{"token":"exampleToken"}},"index":0,"keyPattern":{"token":1},"keyValue":{"token":"exampleToken"},"level":"error","message":"Error inserting token: E11000 duplicate key error collection: pos_dummy.tokens index: token_1 dup key: { token: \"exampleToken\" }","service":"db-service","stack":"MongoServerError: E11000 duplicate key error collection: pos_dummy.tokens index: token_1 dup key: { token: \"exampleToken\" }\n    at InsertOneOperation.execute (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongodb/lib/operations/insert.js:51:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async executeOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongodb/lib/operations/execute_operation.js:136:16)\n    at async Collection.insertOne (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongodb/lib/collection.js:154:16)"}
{"level":"error","message":"Error finding token: Token not found","name":"DbServiceError","service":"db-service","stack":"DbServiceError: Token not found\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:29:17\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async findTokenRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:25:14)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:192:22)","statusCode":404}
{"level":"error","message":"Error finding tokens: sanitizeInput is not a function","service":"db-service","stack":"TypeError: sanitizeInput is not a function\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:94:41\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async findTokensByCriteria (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:92:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:187:13)"}
{"level":"error","message":"Error adding device: Maximum devices limit reached","name":"DbServiceError","service":"db-service","stack":"DbServiceError: Maximum devices limit reached\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:113:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDeviceToToken (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:179:13)","statusCode":400}
{"level":"error","message":"Error adding device: Maximum devices limit reached","name":"DbServiceError","service":"db-service","stack":"DbServiceError: Maximum devices limit reached\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:114:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDeviceToToken (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:107:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:180:13)","statusCode":400}
{"level":"error","message":"Error adding device: Maximum devices limit reached","name":"DbServiceError","service":"db-service","stack":"DbServiceError: Maximum devices limit reached\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:114:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDeviceToToken (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:107:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:180:13)","statusCode":400}
{"level":"error","message":"Error removing device: Device not found","name":"DbServiceError","service":"db-service","stack":"DbServiceError: Device not found\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:140:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDeviceFromToken (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:130:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:206:17)","statusCode":404}
{"code":11000,"errorResponse":{"code":11000,"errmsg":"E11000 duplicate key error collection: pos_dummy.tokens index: token_1 dup key: { token: \"exampleToken\" }","index":0,"keyPattern":{"token":1},"keyValue":{"token":"exampleToken"}},"index":0,"keyPattern":{"token":1},"keyValue":{"token":"exampleToken"},"level":"error","message":"Error inserting token: E11000 duplicate key error collection: pos_dummy.tokens index: token_1 dup key: { token: \"exampleToken\" }","service":"db-service","stack":"MongoServerError: E11000 duplicate key error collection: pos_dummy.tokens index: token_1 dup key: { token: \"exampleToken\" }\n    at InsertOneOperation.execute (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongodb/lib/operations/insert.js:51:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async executeOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongodb/lib/operations/execute_operation.js:136:16)\n    at async Collection.insertOne (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongodb/lib/collection.js:154:16)"}
{"_message":"Token validation failed","errors":{"devices_connected.0.device_id":{"kind":"ObjectId","message":"Cast to ObjectId failed for value \"exampleDeviceId\" (type string) at path \"device_id\" because of \"BSONError\"","name":"CastError","path":"device_id","reason":{},"stringValue":"\"exampleDeviceId\"","value":"exampleDeviceId","valueType":"string"}},"level":"error","message":"Error adding device: Token validation failed: devices_connected.0.device_id: Cast to ObjectId failed for value \"exampleDeviceId\" (type string) at path \"device_id\" because of \"BSONError\"","service":"db-service","stack":"ValidationError: Token validation failed: devices_connected.0.device_id: Cast to ObjectId failed for value \"exampleDeviceId\" (type string) at path \"device_id\" because of \"BSONError\"\n    at Document.invalidate (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongoose/lib/document.js:3312:32)\n    at Subdocument.invalidate (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongoose/lib/types/subdocument.js:229:12)\n    at EmbeddedDocument.$set (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongoose/lib/document.js:1474:12)\n    at EmbeddedDocument.$set (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongoose/lib/document.js:1128:16)\n    at EmbeddedDocument.Document (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongoose/lib/document.js:177:12)\n    at EmbeddedDocument.Subdocument (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongoose/lib/types/subdocument.js:34:12)\n    at EmbeddedDocument.ArraySubdocument [as constructor] (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongoose/lib/types/arraySubdocument.js:44:15)\n    at new EmbeddedDocument (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongoose/lib/schema/documentArray.js:130:17)\n    at Proxy._cast (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongoose/lib/types/documentArray/methods/index.js:103:17)\n    at Proxy._mapCast (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongoose/lib/types/array/methods/index.js:263:17)"}
{"level":"error","message":"Error adding device: deviceRecord is not defined","service":"db-service","stack":"ReferenceError: deviceRecord is not defined\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:125:32\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:245:17)"}
{"level":"error","message":"Error adding device: Validation error: \"token_id\" must be a string","service":"db-service","stack":"Error: Validation error: \"token_id\" must be a string\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:112:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:132:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:246:17)"}
{"level":"error","message":"Error adding device: Validation error: Token ID is required","service":"db-service","stack":"Error: Validation error: Token ID is required\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:117:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:132:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:246:17)"}
{"level":"error","message":"Error adding device: Validation error: \"token_id\" must be a string","service":"db-service","stack":"Error: Validation error: \"token_id\" must be a string\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:117:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:132:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:246:17)"}
{"level":"error","message":"Error adding device: Validation error: \"token_id\" must be a string","service":"db-service","stack":"Error: Validation error: \"token_id\" must be a string\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:116:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:132:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:246:17)"}
{"level":"error","message":"Error adding device: Validation error: \"token_id\" must be a string","service":"db-service","stack":"Error: Validation error: \"token_id\" must be a string\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:116:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:131:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:245:17)"}
{"level":"error","message":"Error adding device: Validation error: Cannot set property _bsontype of [object Object] which has only a getter","service":"db-service","stack":"Error: Validation error: Cannot set property _bsontype of [object Object] which has only a getter\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:113:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:131:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:196:17)"}
{"level":"error","message":"Error adding device: Validation error: Cannot set property _bsontype of [object Object] which has only a getter","service":"db-service","stack":"Error: Validation error: Cannot set property _bsontype of [object Object] which has only a getter\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:113:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:130:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:196:17)"}
{"level":"error","message":"Error adding device: Validation error: \"token_id\" must be a string","service":"db-service","stack":"Error: Validation error: \"token_id\" must be a string\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:112:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:130:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:196:17)"}
{"level":"error","message":"Error adding device: Validation error: \"token_id\" must be a string","service":"db-service","stack":"Error: Validation error: \"token_id\" must be a string\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:112:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:130:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:196:17)"}
{"level":"error","message":"Error adding device: Validation error: \"token_id\" must be a string","service":"db-service","stack":"Error: Validation error: \"token_id\" must be a string\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:112:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:131:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:198:17)"}
{"level":"error","message":"Error adding device: Validation error: \"disconnected_at\" must be a valid date","service":"db-service","stack":"Error: Validation error: \"disconnected_at\" must be a valid date\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:112:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:133:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:200:17)"}
{"level":"error","message":"Error adding device: Validation error: \"$__\" is not allowed","service":"db-service","stack":"Error: Validation error: \"$__\" is not allowed\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:112:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:133:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:200:17)"}
{"level":"error","message":"Error adding device: tokenRecord._id.toObject is not a function","service":"db-service","stack":"TypeError: tokenRecord._id.toObject is not a function\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:124:47\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:200:17)"}
{"level":"error","message":"Error adding device: Validation error: \"$__\" is not allowed","service":"db-service","stack":"Error: Validation error: \"$__\" is not allowed\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:112:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:133:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:201:17)"}
{"level":"error","message":"Error adding device: Maximum devices limit reached","name":"DbServiceError","service":"db-service","stack":"DbServiceError: Maximum devices limit reached\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:117:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:200:17)","statusCode":400}
{"level":"error","message":"Error adding device: Validation error: \"$__\" is not allowed","service":"db-service","stack":"Error: Validation error: \"$__\" is not allowed\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:112:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:133:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:200:17)"}
{"level":"error","message":"Error adding device: Validation error: \"$__\" is not allowed","service":"db-service","stack":"Error: Validation error: \"$__\" is not allowed\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:112:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:133:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:200:17)"}
{"level":"error","message":"Error adding device: Validation error: \"$__\" is not allowed","service":"db-service","stack":"Error: Validation error: \"$__\" is not allowed\n    at validateDeviceRecord (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbValidation.js:112:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:133:13\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:200:17)"}
{"_message":"Device validation failed","errors":{"device_id":{"kind":"required","message":"Path `device_id` is required.","name":"ValidatorError","path":"device_id","properties":{"message":"Path `device_id` is required.","path":"device_id","type":"required","value":null},"value":null}},"level":"error","message":"Error adding device: Device validation failed: device_id: Path `device_id` is required.","service":"db-service","stack":"ValidationError: Device validation failed: device_id: Path `device_id` is required.\n    at Document.invalidate (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongoose/lib/document.js:3312:32)\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongoose/lib/document.js:3073:17\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/node_modules/mongoose/lib/schemaType.js:1388:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)"}
{"level":"error","message":"Error removing device: No devices connected","name":"DbServiceError","service":"db-service","stack":"DbServiceError: No devices connected\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:156:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:145:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:233:17)","statusCode":400}
{"level":"error","message":"Error removing device: Device.findOneAndRemove is not a function","service":"db-service","stack":"TypeError: Device.findOneAndRemove is not a function\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:160:47\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:145:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:233:17)"}
{"level":"error","message":"Error removing device: deviceRecord is not defined","service":"db-service","stack":"ReferenceError: deviceRecord is not defined\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:166:65\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:145:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:233:17)"}
{"level":"error","message":"Error removing device: Device not found","name":"DbServiceError","service":"db-service","stack":"DbServiceError: Device not found\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:162:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:145:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:235:17)","statusCode":404}
{"level":"error","message":"Error adding device: Maximum devices limit reached","name":"DbServiceError","service":"db-service","stack":"DbServiceError: Maximum devices limit reached\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:117:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:232:17)","statusCode":400}
{"level":"error","message":"Error removing device: Device not found","name":"DbServiceError","service":"db-service","stack":"DbServiceError: Device not found\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:162:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:145:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:235:17)","statusCode":404}
{"level":"error","message":"Error removing device: No devices connected","name":"DbServiceError","service":"db-service","stack":"DbServiceError: No devices connected\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:156:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:145:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:237:17)","statusCode":400}
{"level":"error","message":"Error removing device: Test error","service":"db-service","stack":"Error: Test error\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:170:19\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:145:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:237:17)"}
{"level":"error","message":"Error removing device: Device not found in token","name":"DbServiceError","service":"db-service","stack":"DbServiceError: Device not found in token\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:169:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:145:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:235:17)","statusCode":404}
{"level":"error","message":"Error removing device: Cannot read properties of undefined (reading 'toString')","service":"db-service","stack":"TypeError: Cannot read properties of undefined (reading 'toString')\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:168:64\n    at Proxy.findIndex (<anonymous>)\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:167:57\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:145:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:237:17)"}
{"level":"error","message":"Error removing device: Cannot read properties of undefined (reading 'toString')","service":"db-service","stack":"TypeError: Cannot read properties of undefined (reading 'toString')\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:168:46\n    at Proxy.findIndex (<anonymous>)\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:167:57\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:145:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:237:17)"}
{"level":"error","message":"Error removing device: Cannot read properties of undefined (reading 'toString')","service":"db-service","stack":"TypeError: Cannot read properties of undefined (reading 'toString')\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:168:58\n    at Proxy.findIndex (<anonymous>)\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:167:57\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:145:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:237:17)"}
{"level":"error","message":"Error removing device: No devices connected","name":"DbServiceError","service":"db-service","stack":"DbServiceError: No devices connected\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:156:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:145:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:232:17)","statusCode":400}
{"level":"error","message":"Error adding device: Maximum devices limit reached","name":"DbServiceError","service":"db-service","stack":"DbServiceError: Maximum devices limit reached\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:117:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async addDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:106:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:229:17)","statusCode":400}
{"level":"error","message":"Error removing device: Device not found","name":"DbServiceError","service":"db-service","stack":"DbServiceError: Device not found\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:163:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:145:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:232:17)","statusCode":404}
{"level":"error","message":"Error removing device: No devices connected","name":"DbServiceError","service":"db-service","stack":"DbServiceError: No devices connected\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:156:23\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async removeDevice (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:145:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:232:17)","statusCode":400}
{"level":"error","message":"Error finding tokens: token is not defined","service":"db-service","stack":"ReferenceError: token is not defined\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:98:38\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async findTokensByCriteria (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:95:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:226:33)"}
{"level":"error","message":"Error finding tokens: token is not defined","service":"db-service","stack":"ReferenceError: token is not defined\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:98:38\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async findTokensByCriteria (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:95:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:226:33)"}
{"level":"error","message":"Error finding tokens: token is not defined","service":"db-service","stack":"ReferenceError: token is not defined\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:98:38\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async findTokensByCriteria (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:95:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:226:33)"}
{"level":"error","message":"Error finding tokens: token is not defined","service":"db-service","stack":"ReferenceError: token is not defined\n    at /home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:98:38\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async retryOperation (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbUtils.js:34:14)\n    at async findTokensByCriteria (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:95:16)\n    at async runService (/home/narindrans-wsl/programming/WiFi-Integrated-PoS-System/backend/services/dbService/dbService.js:226:33)"}
